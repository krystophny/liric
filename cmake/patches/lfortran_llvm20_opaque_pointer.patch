diff --git a/CMakeLists.txt b/CMakeLists.txt
index f57b531da..40eab82d8 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -151,6 +151,8 @@ endif()
 set(WITH_LLVM no CACHE BOOL "Build with LLVM support")
 set(WITH_LIRIC no CACHE BOOL "Use liric as LLVM replacement (C++ compat headers)")
 set(LIRIC_DIR "" CACHE PATH "Path to liric source/build directory")
+set(LIRIC_REQUIRE_REAL_LLVM_LINK no CACHE BOOL
+    "When WITH_LIRIC is enabled, link LLVM libraries required by liric")
 set(WITH_TARGET_AARCH64 no CACHE BOOL "Enable target AARCH64")
 set(WITH_TARGET_X86 no CACHE BOOL "Enable target X86")
 set(WITH_TARGET_WASM no CACHE BOOL "Enable target WebAssembly")
@@ -235,8 +237,39 @@ if (WITH_LIRIC)
         "${LIRIC_DIR}/include")
     set_property(TARGET p::llvm PROPERTY INTERFACE_COMPILE_OPTIONS
         $<$<COMPILE_LANGUAGE:CXX>:${LFORTRAN_CXX_NO_RTTI_FLAG}>)
+    set(_lfortran_liric_link_libs "${LIRIC_LIB}" stdc++)
+    if (LIRIC_REQUIRE_REAL_LLVM_LINK)
+        find_package(LLVM REQUIRED)
+        message(STATUS "Found LLVM ${LLVM_PACKAGE_VERSION} for WITH_LIRIC linkage")
+        message(STATUS "Using LLVMConfig.cmake in: ${LLVM_DIR}")
+        set(_lfortran_liric_saved_suffixes "${CMAKE_FIND_LIBRARY_SUFFIXES}")
+        if (APPLE)
+            set(CMAKE_FIND_LIBRARY_SUFFIXES .dylib .tbd)
+        elseif(UNIX)
+            set(CMAKE_FIND_LIBRARY_SUFFIXES .so)
+        endif()
+        find_library(_lfortran_liric_llvm_c_lib
+            NAMES LLVM-C libLLVM-C LLVM
+            PATHS ${LLVM_LIBRARY_DIRS})
+        set(CMAKE_FIND_LIBRARY_SUFFIXES "${_lfortran_liric_saved_suffixes}")
+        if (_lfortran_liric_llvm_c_lib)
+            set(_lfortran_liric_llvm_libs "${_lfortran_liric_llvm_c_lib}")
+        else()
+            message(WARNING
+                "Could not find shared LLVM C API library; falling back to LLVM C++ components")
+            set(_lfortran_liric_llvm_components
+                core support mcjit orcjit native asmparser asmprinter)
+            if (TARGET LLVMCore)
+                llvm_map_components_to_libnames(_lfortran_liric_llvm_libs
+                    ${_lfortran_liric_llvm_components})
+            else()
+                set(_lfortran_liric_llvm_libs "LLVM")
+            endif()
+        endif()
+        list(APPEND _lfortran_liric_link_libs ${_lfortran_liric_llvm_libs})
+    endif()
     set_property(TARGET p::llvm PROPERTY INTERFACE_LINK_LIBRARIES
-        "${LIRIC_LIB}" stdc++)
+        ${_lfortran_liric_link_libs})
     set(HAVE_LFORTRAN_LLVM yes)
     set(WITH_LLVM yes)
 elseif (WITH_LLVM)
diff --git a/src/libasr/codegen/llvm_utils.h b/src/libasr/codegen/llvm_utils.h
index b1aa2e123..9dd780c8f 100644
--- a/src/libasr/codegen/llvm_utils.h
+++ b/src/libasr/codegen/llvm_utils.h
@@ -1214,7 +1214,7 @@ if(get_struct_sym(member_variable) == struct_sym /*recursive declaration*/){cont
             if(is_class_type){
                 auto const class_type_llvm = llvm_utils_->getClassType(struct_sym);
                 auto const consecutive_field_ptr = llvm_utils_->CreateGEP2(class_type_llvm, data_ptr, 1);
-                auto const consecutive_field_type = consecutive_field_ptr->getType()->getPointerElementType();
+                auto const consecutive_field_type = class_type_llvm->getStructElementType(1);
                 auto const allocated_cosecutive_structs = builder_->CreateLoad(consecutive_field_type, consecutive_field_ptr);
                 llvm_utils_->lfortran_free(allocated_cosecutive_structs);
                 // deallocate class wrapper 
